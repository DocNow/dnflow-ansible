---
  - name: create configuration file
    become_user: docnow
    copy: remote_src=True src=/home/docnow/dnflow/dnflow.cfg.template dest=/home/docnow/dnflow/dnflow.cfg

  - name: copy luigid daemonize script
    copy: src=./docnow/files/luigid.sh dest=/home/docnow/luigid.sh mode="a+x"

  - name: launch luigid
    become_user: docnow
    command: "nohup /home/docnow/luigid.sh"
    args:
      chdir: /home/docnow

  - name: copy rq startup script
    copy: src=./docnow/files/rqworker.sh dest=/home/docnow/rqworker.sh mode="a+x" 

  - name: start the rq worker
    become_user: docnow
    command: "nohup /home/docnow/rqworker.sh" 
    args:
      chdir: /home/docnow

  - name: db to track searches
    become_user: docnow
    shell: sqlite3 db.splite3 < schema.sql 
    args:
      chdir: /home/docnow/dnflow

  - name: copy application ini file
    copy: src=./docnow/files/docnow.ini dest=/home/docnow/dnflow/docnow.ini owner=docnow group=docnow

  - name: copy upstart script
    copy: src=./docnow/templates/docnow.conf dest=/etc/init/docnow.conf

  - name: start application
    service: name=docnow state=started

  - name: restart webserver
    service: name=nginx state=restarted
